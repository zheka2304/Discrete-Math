<html>
<body id="root">
	<script type="text/javascript">
		/* ALL LINKS AND CONSTANTS ARE STORED HERE */
		// path to source code
		const SOURCE_PATH = "homework/eugene/hw-1.js"
		
		// path to boot modules JSON list
		const BOOT_MODULES_PATH = "api/boot_modules.json"
		
		// path to api modules JSON list
		const API_MODULES_PATH = "api/api_modules.json"
		
		// link to github with raw 
		const GIT_REPOSITORY_URL = "http://localhost/"; //"https://raw.githubusercontent.com/zheka2304/Discrete-Math/master/"
	</script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>
	<script type="text/javascript">

		function load_url_content(url) {
			var result = null;
			$.ajax({
				url: url,
				type: "GET",
				dataType: 'text',
				async: false,
				
				success: function(res) {
					result = res;
				},
				
				error: function(res) {
					alert("error " + JSON.stringify(res))
				}
			});
			return result;
		}
		
		function get_module_list(url) {
			var content = null;
			try {
				content = load_url_content(url);
				return JSON.parse(content);
			} catch(err) {
				alert("failed to read module list from " + url + " error=" + err + " content=" + content);
				return [];
			}
		}
		
		function get_root_content() {
			return document.getElementById("root").innerHTML;
		}
		
		function set_root_content(html) {
			document.getElementById("root").innerHTML = html;
		}
		
		
		
		function Executable(params) {
			this.source = null;
			this.exception = null;
			this.is_evaluated = false;
			
			if (params.source) {
				this.source = params.source;
			}
			
			if (params.url) {
				this.source = load_url_content(params.url); 
			}
			
			this.load = function() {
				try {
					eval(this.source);
					this.is_evaluated = true;
				} catch (err) {
					this.exception = err;
				}
			}
			
			this.log = function() {
				
			}
		}
		
		
		
		
		function on_load() {
			var boot_modules = [];
			get_module_list(GIT_REPOSITORY_URL + BOOT_MODULES_PATH).map(function(path) {
				boot_modules[boot_modules.length] = new Executable({
					url: GIT_REPOSITORY_URL + path
				});
			});
			
			boot_modules.map(function(module) {
				module.load();
				if (module.exception != null) {
					alert("error in module: " + module.exception);
				}
			});
		}

		window.onload = function() {
			try { 
				on_load();
			} catch(error) {
				alert("error ocurred: " + error)
			}
		};
	</script>

</body>
</html>